[0126]In operation, the controller may input conventional drilling parameters, such as rig pump flow rate (from the flow meter FM), stand pipe pressure (SPP) (from sensor G1), well head pressure (WHP) (from the sensor in the returns outlet), torque exerted by the top drive (or rotary table), bit depth and/or hole depth, the rotational velocity of the drill string 105, and the upward force that the rig works exert on the drill string 8 (hook load). The drilling parameters may also include mud density, drill string dimensions, and casing dimensions.
[0127]Simultaneously, the controller may input a pressure measurement from the casing pressure sensor. The communication between the controller and the drilling parameters sources and the casing sensor may be high bandwidth and at light speed. From at least some of the drilling parameters, the controller may calculate an annulus flow model or pressure profile. The controller may then calibrate the annulus flow model using at least one of: the casing pressure measurement, the SPP measurement, and the WHP measurement. Using the calibrated annulus flow model, the controller may determine an annulus pressure at a desired depth, such as bottomhole.
[0128]The controller may compare the calculated annulus pressure to one or more formation threshold pressures (i.e., pore pressure or fracture pressure) to determine if a setting of the choke valve needs to be adjusted. Alternatively, the controller may instead alter the injection rate of drilling fluid and/or alter the density of the drilling fluid. Alternatively, the controller may determine if the calculated annulus pressure is within a window defined by two of the threshold pressures. If the choke setting needs to be adjusted, the controller may determine a choke setting that maintains the calculated annulus pressure within a desired operating window or at a desired level (i.e., greater than or equal to) with respect to the one or more threshold pressures at the desired depth. The controller may then send a control signal to the choke valve to vary the choke so that the calculated annulus pressure is maintained according to the desired program. The controller may iterate this process continuously (i.e., in real time). This is advantageous in that sudden formation changes or events (i.e., a kick) can be immediately detected and compensated for (i.e., by increasing the backpressure exerted on the annulus by the choke).
[0129]The controller may also input a BHP from the BHA sensor. Since this measurement may be transmitted using wireless telemetry, the measurement may be not available in real time. However, the BHP measurement may still be valuable especially as the distance between the casing sensor and the BH becomes significant. Since the desired depth may be below the casing sensor, the controller may extrapolate the calibrated flow model to calculate the desired depth. Regularly calibrating the annular flow model with the BHP may thus improve the accuracy of the annulus flow model.
[0130]During adding or removing joints or stands to/from the drill string and while injecting drilling fluid through the CFS port, the controller may also maintain the calculated annulus pressure with respect to the formation threshold pressure or window.